<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>rhythm</title>
        <style>
            :root {
                --error-dark: #400;
                --error-light: #fbb;
            }

            body {
                font-family: sans-serif;
                background-color: #004;
                color: white;
                text-align: center;
            }

            .error-box {
                color: var(--error-dark);
                background-color: var(--error-light);
                border: 1px solid var(--error-dark);
                padding: 1em;
            }

            .container {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                margin: auto;
            }
        </style>
    </head>
    <body>
        <!-- message to show when Javascript is not available -->
        <noscript>
            <div class="error-box">
                Javascript is required to run the game.
            </div>
        </noscript>
        <!-- message box to present other runtime errors to the user -->
        <div id="runtime-error" class="error-box" hidden>
            <span id="error-message"></span>
        </div>
        <!-- canvas to render to -->
        <div id="container">
            <canvas id="canvas"></canvas>
            <div id="firefox-warning" hidden>
                <strong>
                    Firefox has <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=587465">known issues</a>
                    with audio precision, so gameplay might be choppy. Consider using
                    a Chromium-based browser for the best experience. Sorry!
                </strong>
            </div>
        </div>
        <!-- browser checks and emscripten setup -->
        <script type="text/javascript">
            // show an error message
            function showError(message) {
                document.getElementById('error-message').textContent = message;
                document.getElementById('runtime-error').hidden = false;
            }
            // display a notice for firefox users
            if (navigator.userAgent.includes('Firefox')) {
                document.getElementById('firefox-warning').hidden = false;
            }
            // set up runtime errors to display in the error box
            window.addEventListener('error', function(e) {
                showError(e.error.toString());
                return false;
            });
            // get the WebGL context, explicitly turning off antialiasing
            var webgl = document.getElementById('canvas').getContext('webgl', {
                antialias: false,
            });
            // check WebGL availability
            if (!webgl) {
                // show the message
                showError('WebGL is required to run the game.');
            }
            // variables for library
            openAudios = {};
            readyAudios = {};
            audioId = 0;

            readyRequests = {};
            requestId = 0;
        </script>
        {{{ SCRIPT }}}
    </body>
</html>
